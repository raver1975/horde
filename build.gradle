buildscript {
    dependencies {
        classpath 'com.sandec.jpro:jpro-plugin-gradle:2021.2.2'
        //classpath 'org.openjfx:javafx-plugin:0.0.10'
    }
    repositories {
        mavenLocal()
        mavenCentral()
        gradlePluginPortal()

        maven {
            url "https://sandec.jfrog.io/artifactory/repo"
        }
    }
}



plugins {
    id 'java'
    id 'application'
//    id 'java-library'
    id 'com.github.johnrengelman.shadow' version '7.1.2'
    id 'org.openjfx.javafxplugin' version '0.0.8'
//    id 'com.redock.classpathtofile' version '0.0.1'
//    id 'org.bytedeco.gradle-javacpp-build' version '1.5.24-SNAPSHOT'
//    id 'org.bytedeco.gradle-javacpp-platform' version 'windows-x86_64'
}
//def javacppPlatform = Loader.getPlatform()

group 'com.kg'
version '0.1'
apply plugin: 'com.google.osdetector'
ext.platform = osdetector.os == 'osx' ? 'mac' : osdetector.os == 'windows' ? 'win' : osdetector.os

//sourceCompatibility = 1.8


repositories {
    mavenLocal()
    mavenCentral()
    maven { url 'https://clojars.org/repo/'}
    //maven { url 'https://repo.gradle.org/gradle/libs-releases' }
}

dependencies {
    //testCompile group: 'junit', name: 'junit', version: '4.12'
    implementation group: 'org.simpleframework', name: 'simple-xml', version: '2.7.1'
    implementation group: 'com.googlecode.soundlibs', name: 'tritonus-share', version: '0.3.7.4'
//    implementation 'org.openjfx:javafx:+'
//    implementation 'org.openjfx:javafx:+'
//    implementation 'org.openjfx:javafx:14-ea+6'
    // Add your dependencies here, for example:
    // implementation group: 'org.controlsfx', name: 'controlsfx', version: '8.40.14'
    implementation "org.openjfx:javafx-base:13:$platform"
    implementation "org.openjfx:javafx-graphics:13:$platform"
    implementation "org.openjfx:javafx-controls:13:$platform"
    implementation "org.openjfx:javafx-fxml:13:$platform"
    implementation "org.openjfx:javafx-media:13:$platform"
    implementation "org.openjfx:javafx-web:13:$platform"

//    implementation group: 'com.palantir.python.miniconda', name: 'com.palantir.python.miniconda.gradle.plugin', version: '0.8.0', ext: 'pom'
//    api 'anaconda:protobuf:3.8.0'
//    test conda-forge:pytest:5.1.2

    implementation group: 'org.apache.httpcomponents', name: 'httpclient', version: '4.5.3'
    implementation group: 'org.apache.httpcomponents', name: 'httpcore', version: '4.4.6'
    implementation group: 'com.google.guava', name: 'guava', version: '11.0.2'
    implementation group: 'org.bytedeco', name: 'javacv', version: '1.3.1'
    implementation group: 'net.sf.json-lib', name: 'json-lib', version: '2.4', classifier: 'jdk15'
    implementation group: 'com.googlecode.json-simple', name: 'json-simple', version: '1.1'
    implementation('se.michaelthelin.spotify:spotify-web-api-java:1.5.0')

    implementation group: 'org.encog', name: 'encog-core', version: '3.3.0'

    implementation group: 'org.bytedeco', name: 'javacpp', version: '1.5'
    implementation group: 'org.bytedeco', name: 'cuda', version: '9.2-7.2-1.5'
    implementation group: 'org.bytedeco', name: 'javacv-platform', version: '1.5'
    implementation group: 'org.bytedeco', name: 'javacpp-presets', version: '1.5'
    implementation 'org.deeplearning4j:deeplearning4j-nlp:1.0.0-beta3'
    implementation 'org.nd4j:nd4j-cuda-9.2:1.0.0-beta3'
    implementation 'org.nd4j:nd4j-cuda-9.2-platform:1.0.0-beta3'

    implementation group: 'jfree', name: 'jfreechart', version: '1.0.13'
    implementation group: 'org.slf4j', name: 'slf4j-simple', version: '1.7.25'
    implementation fileTree(include: ['*.jar'], dir: 'libs/Algs4')
    implementation fileTree(include: ['*.jar'], dir: 'libs/Graphstream')
    implementation fileTree(include: ['*.jar'], dir: 'libs/Hsqldb')
    implementation fileTree(include: ['*.jar'], dir: 'libs/JGraphT')
    implementation fileTree(include: ['*.jar'], dir: 'libs/MusicG')
    implementation fileTree(include: ['*.jar'], dir: 'libs/Sqljet')
    implementation fileTree(include: ['*.jar'], dir: 'libs/Tarsos')
    implementation fileTree(include: ['*.jar'], dir: 'libs/Weka')
    implementation fileTree(include: ['*.jar'], dir: 'libs/Wub')
    implementation 'com.google.code.gson:gson:2.8.6'
    // https://mvnrepository.com/artifact/expiring-map/expiring-map
    implementation group: 'expiring-map', name: 'expiring-map', version: '0.1.9'

//    implementation "org.gradle:gradle-tooling-api:+"
    // The tooling API need an SLF4J implementation available at runtime, replace this with any other implementation
//    runtimeOnly 'org.slf4j:slf4j-simple:1.7.10'

}

//
javafx {
    version = "13"
    modules = ['javafx.controls', 'javafx.fxml', 'javafx.base', 'javafx.graphics', 'javafx.media', 'javafx.swing', 'javafx.web']
}

application {
//    mainClassName = 'eu.hansolo.fx.regulators.Main'
    mainClassName = 'com.kg.TheHorde'
}

sourceSets {
    main {
        java {
            srcDir 'src'
        }
        resources {
            srcDir 'data'
        }
    }
}

compileJava {
    doFirst {
        def classpathJavaFX = classpath.filter{ File file ->
            file.name.contains( "javafx" )
        }
        options.compilerArgs = [
                '--module-path',classpathJavaFX.asPath,
                '--add-exports', 'java.desktop/com.sun.media.sound=ALL-UNNAMED',
                '--add-modules', 'javafx.fxml,javafx.controls'
        ]
    }
}


run {
//    if (project.hasProperty("appArgs")) {
//        args Eval.me(appArgs)
//    }
    doFirst {
        def classpathJavaFX = classpath.filter{ File file ->
            file.name.contains( "javafx" )
        }
        jvmArgs = [
                '--module-path', classpathJavaFX.asPath,
                '--add-exports', 'java.desktop/com.sun.media.sound=ALL-UNNAMED',
                '--add-modules', 'javafx.fxml,javafx.controls',
        ]
        if (project.hasProperty("args")){
            args(project.property("args"))
        }
    }
}

jar {
    manifest {
        attributes 'Main-Class': 'com.kg.Main'
    }

    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
        sourceSets.main.output
    }


}

shadowJar {
    baseName = 'horde'
    classifier = null
    version = null
    zip64 true
}

//apply plugin: 'javafx-gradle-plugin'
//jfx {
//    // minimal requirement for jfxJar-task
//    mainClass = 'com.klemstine.TheHorde'
//
//    // minimal requirement for jfxNative-task
//    vendor = 'KlemstineGroup'
//}

/**
 ******************  jpro Configuration ******************
 */
apply plugin: 'com.sandec.jpro'


/**
 * App Main Class
 */
//mainClassName = 'com.jpro.hellojpro.HelloJPro'
mainClassName = 'com.kg.TheHorde'

/**
 * jpro settings
 */
jpro {
    // for debugging
    // JVMArgs << '-agentlib:jdwp=transport=dt_socket,server=n,address=5006,suspend=y'

    JVMArgs << '-Xmx1000m'

    //jpro server port
    port = 8080

}

/*task installSpleeter {
    doLast {
        exec {
            workingDir 'spleeter'
            commandLine 'python', 'setup.py'
        }
//        exec {
//            workingDir 'spleeter'
//            commandLine 'python','-m','spleeter', 'separate','-h'
//        }
    }


}*/
//task runSpleeter {
//    if (System.hasProperty("spleeter1")) {
//        doLast {
//            exec {
//                workingDir 'spleeter'
//                commandLine 'python', 'setup.py'
//            }
//            exec {
////            workingDir '.'
//                commandLine 'python', '-m', 'spleeter', 'separate', '-p', 'spleeter:2stems', '-i', System.properties['spleeter1'], '-o', System.properties['spleeter2']
////            commandLine 'spleeter', System.properties['spleeter']
//            }
//        }
//    }
//}

/*task runSpleeter2 {
    doLast {
        exec {
            workingDir './venv/Scripts'
            commandLine 'python', '-m', 'spleeter', System.properties['spleeter']
        }
    }

}*/
